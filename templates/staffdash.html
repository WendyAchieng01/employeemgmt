{% extends 'base1.html' %}

{% block title %}Staff Dashboard{% endblock %}

{% block content %}
{% load static %}

<div class="container-fluid px-2 px-md-4">
  <!-- Page Header with background -->
  <div class="page-header min-height-300 border-radius-xl mt-4" 
       style="background-image: url('https://images.unsplash.com/photo-1531512073830-ba890ca4eba2?auto=format&fit=crop&w=1920&q=80');">
    <span class="mask bg-gradient-dark opacity-6"></span>
  </div>

  <!-- Main Card -->
  <div class="card card-body mx-2 mx-md-2 mt-n6">
    <!-- Header Buttons -->
    <div class="d-flex justify-content-between mb-4">
      <button onclick="goToReferrer()" class="btn btn-outline-primary btn-sm">
        <i class="material-symbols-rounded text-sm">arrow_back</i>
        Back
      </button>
      <button class="btn btn-outline-primary btn-sm">
        <i class="material-symbols-rounded text-sm">download</i>
        Export PDF
      </button>
    </div>

    <!-- Profile Header -->
    <div class="row gx-4 mb-4">
      <div class="col-auto">
        <div class="avatar avatar-xl position-relative">
          <span class="material-symbols-rounded text-xl bg-gradient-dark text-white d-flex align-items-center justify-content-center rounded-circle shadow-sm p-3">
            person
          </span>
        </div>
      </div>
      <div class="col-auto my-auto">
        <div class="h-100">
          <h5 class="mb-1">{{ staff.full_name }}</h5>
          <p class="mb-0 font-weight-normal text-sm">{{ staff.designation }}</p>
          <span class="badge bg-gradient-success mt-2">
            <i class="material-symbols-rounded text-sm align-middle">check_circle</i>
            {{ staff.get_employment_status_display }}
          </span>
        </div>
      </div>
    </div>

    <!-- Info Sections -->
    <div class="row">
      <!-- Quick Information -->
      <div class="col-xl-4 col-md-6 mb-4">
        <div class="card card-plain h-100">
          <div class="card-header pb-0">
            <h6>
              <i class="material-symbols-rounded text-sm me-1">info</i>
              Quick Information
            </h6>
          </div>
          <div class="card-body p-3">
            <ul class="list-group">
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Unique ID:</strong> {{ staff.unique_id }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Department:</strong> {{ staff.department.name }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Years of Service:</strong> {{ staff.years_of_service }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Employment Date:</strong> {{ staff.employment_date|date:"M d, Y" }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Status:</strong>
                <span class="badge bg-gradient-success">
                  <i class="material-symbols-rounded text-sm align-middle">check_circle</i>
                  {{ staff.get_employment_status_display }}
                </span>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Emergency Contact -->
      <div class="col-xl-4 col-md-6 mb-4">
        <div class="card card-plain h-100">
          <div class="card-header pb-0">
            <h6>
              <i class="material-symbols-rounded text-sm me-1">emergency</i>
              Emergency Contact
            </h6>
          </div>
          <div class="card-body p-3">
            <ul class="list-group">
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Name:</strong> {{ staff.emergency_contact_name|default:"Not provided" }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Phone:</strong> {{ staff.emergency_contact_phone|default:"Not provided" }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Relationship:</strong> {{ staff.emergency_contact_relationship|default:"Not provided" }}
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Personal Information -->
      <div class="col-xl-4 col-md-6 mb-4">
        <div class="card card-plain h-100">
          <div class="card-header pb-0">
            <h6>
              <i class="material-symbols-rounded text-sm me-1">person</i>
              Personal Information
            </h6>
          </div>
          <div class="card-body p-3">
            <ul class="list-group">
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>User Account:</strong> {{ staff.user.username|default:"Not linked" }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Middle Name:</strong> {{ staff.middle_name|default:"Not provided" }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Email:</strong> {{ staff.email }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Phone:</strong> {{ staff.phone }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Gender:</strong> {{ staff.get_gender_display }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Date of Birth:</strong> {{ staff.date_of_birth|date:"M d, Y" }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>National ID:</strong> {{ staff.national_id }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Address:</strong> {{ staff.address }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>KRA PIN:</strong> {{ staff.kra_pin|default:"Not provided" }}
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Employment & Contract Info -->
    <div class="row">
      <div class="col-xl-6 mb-4">
        <!-- Employment Information -->
        <div class="card card-plain h-100">
          <div class="card-header pb-0">
            <h6>
              <i class="material-symbols-rounded text-sm me-1">work</i>
              Employment Information
            </h6>
          </div>
          <div class="card-body p-3">
            <ul class="list-group">
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Designation:</strong> {{ staff.designation }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Employment Category:</strong> {{ staff.get_employment_category_display }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Salary:</strong> KSh {{ staff.salary|default:"Not provided" }}
              </li>
              <li class="list-group-item border-0 px-0 text-sm">
                <strong>Admin Status:</strong> {{ staff.is_admin|yesno:"Admin,Non-Admin" }}
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="col-xl-6 mb-4">
        <!-- Current Contract -->
        <div class="card card-plain h-100">
          <div class="card-header pb-0">
            <h6>
              <i class="material-symbols-rounded text-sm me-1">description</i>
              Current Contract
            </h6>
          </div>
          <div class="card-body p-3">
            {% if staff.current_contract %}
              <ul class="list-group">
                <li class="list-group-item border-0 px-0 text-sm">
                  <strong>Contract Type:</strong> {{ staff.current_contract.get_contract_type_display }}
                </li>
                <li class="list-group-item border-0 px-0 text-sm">
                  <strong>Start Date:</strong> {{ staff.current_contract.start_date|date:"M d, Y" }}
                </li>
                <li class="list-group-item border-0 px-0 text-sm">
                  <strong>End Date:</strong> {{ staff.current_contract.end_date|date:"M d, Y"|default:"Present" }}
                </li>
                <li class="list-group-item border-0 px-0 text-sm">
                  <strong>Salary:</strong> KSh {{ staff.current_contract.salary }}
                </li>
                <li class="list-group-item border-0 px-0 text-sm">
                  <strong>Job Title:</strong> {{ staff.current_contract.job_title }}
                </li>
                <li class="list-group-item border-0 px-0 text-sm">
                  <strong>Department:</strong> {{ staff.current_contract.department.name }}
                </li>
                <li class="list-group-item border-0 px-0 text-sm">
                  <strong>Benefits:</strong> {{ staff.current_contract.benefits|default:"Not provided" }}
                </li>
                <li class="list-group-item border-0 px-0 text-sm">
                  <strong>Status:</strong> {{ staff.current_contract.get_status_display }}
                </li>
                <li class="list-group-item border-0 px-0 text-sm">
                  <strong>Notes:</strong> {{ staff.current_contract.notes|default:"Not provided" }}
                </li>
              </ul>
              {% if staff.current_contract.document %}
                <a href="{{ staff.current_contract.document.url }}" class="btn btn-outline-primary btn-sm">
                  <i class="material-symbols-rounded text-sm">visibility</i> View {{ staff.first_name }}'s Documents
                </a>
              {% endif %}
            {% else %}
              <p>No active contract found.</p>
              <a href="{% url 'core:contract_create' staff.unique_id %}" class="btn btn-primary btn-sm">
                <i class="material-symbols-rounded text-sm">add</i> Create New Contract
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Contract History -->
    <div class="row">
      <div class="col-12">
        <div class="card card-plain h-100">
          <div class="card-header pb-0">
            <h6>
              <i class="material-symbols-rounded text-sm me-1">history</i>
              Contract History
            </h6>
          </div>
          <div class="card-body p-3">
            {% if staff.contract_history %}
              <ul class="list-group">
                {% for contract in staff.contract_history %}
                  <li class="list-group-item border-0 px-0 text-sm">
                    {{ contract.get_contract_type_display }} ({{ contract.start_date|date:"M d, Y" }} - {{ contract.end_date|date:"M d, Y"|default:"Present" }})
                    - {{ contract.job_title }} in {{ contract.department.name }}
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <p>No contract history available.</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}